{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PaperEvidenceV1",
  "description": "Trade-level paper trading evidence for EDGE_LAB â€” EPOCH P0 schema. Validates timestamps, fills, fees, market context, and anti-tamper hash.",
  "type": "object",
  "required": [
    "schema_version",
    "epoch_id",
    "start_date",
    "end_date",
    "instrument",
    "venue",
    "evidence_hash",
    "rounding_policy",
    "venue_fee_policy",
    "trades",
    "total_trades",
    "generated_at"
  ],
  "additionalProperties": false,
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0"
    },
    "epoch_id": {
      "type": "string",
      "minLength": 1,
      "pattern": "^PAPER_EPOCH_[A-Z0-9_]+$"
    },
    "start_date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "end_date": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}$"
    },
    "instrument": {
      "type": "string",
      "enum": ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
    },
    "venue": {
      "type": "string",
      "enum": ["BINANCE_TESTNET", "BINANCE_PAPER", "OKX_PAPER"]
    },
    "evidence_hash": {
      "type": "string",
      "description": "SHA256 of canonical trades JSON. Computed by: sort trades by trade_id, sort fills by fill_ts, JSON.stringify with fixed key order.",
      "pattern": "^[0-9a-f]{64}$"
    },
    "rounding_policy": {
      "type": "object",
      "required": ["max_fill_qty_drift_pct", "description"],
      "additionalProperties": false,
      "properties": {
        "max_fill_qty_drift_pct": {
          "type": "number",
          "exclusiveMinimum": 0,
          "maximum": 0.01,
          "description": "Max % drift between sum(fill.qty) and requested_qty"
        },
        "description": {
          "type": "string",
          "minLength": 5
        }
      }
    },
    "venue_fee_policy": {
      "type": "object",
      "required": ["min_fee_rate", "fee_currencies", "description"],
      "additionalProperties": false,
      "properties": {
        "min_fee_rate": {
          "type": "number",
          "exclusiveMinimum": 0,
          "maximum": 0.01
        },
        "fee_currencies": {
          "type": "array",
          "minItems": 1,
          "items": { "type": "string", "enum": ["USDT", "BNB", "ETH"] }
        },
        "description": {
          "type": "string",
          "minLength": 5
        }
      }
    },
    "trades": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": [
          "trade_id",
          "candidate",
          "side",
          "requested_qty",
          "instrument",
          "signal_ts",
          "order_submit_ts",
          "ack_ts",
          "fills",
          "bid_at_signal",
          "ask_at_signal",
          "context_volatility",
          "result"
        ],
        "additionalProperties": false,
        "properties": {
          "trade_id": {
            "type": "string",
            "pattern": "^[A-Z0-9_]+$",
            "minLength": 3
          },
          "candidate": {
            "type": "string",
            "pattern": "^H_[A-Z_]+$"
          },
          "side": {
            "type": "string",
            "enum": ["BUY", "SELL"]
          },
          "requested_qty": {
            "type": "number",
            "exclusiveMinimum": 0
          },
          "instrument": {
            "type": "string",
            "enum": ["BTCUSDT", "ETHUSDT", "SOLUSDT"]
          },
          "signal_ts": {
            "type": "string",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
          },
          "order_submit_ts": {
            "type": "string",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
          },
          "ack_ts": {
            "type": "string",
            "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
          },
          "fills": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["fill_ts", "qty", "price", "fee_amount", "fee_currency"],
              "additionalProperties": false,
              "properties": {
                "fill_ts": {
                  "type": "string",
                  "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
                },
                "qty": {
                  "type": "number",
                  "exclusiveMinimum": 0
                },
                "price": {
                  "type": "number",
                  "exclusiveMinimum": 0
                },
                "fee_amount": {
                  "type": "number",
                  "minimum": 0
                },
                "fee_currency": {
                  "type": "string",
                  "enum": ["USDT", "BNB", "ETH"]
                }
              }
            }
          },
          "bid_at_signal": {
            "type": "number",
            "exclusiveMinimum": 0
          },
          "ask_at_signal": {
            "type": "number",
            "exclusiveMinimum": 0
          },
          "context_volatility": {
            "type": "string",
            "enum": ["LOW", "MEDIUM", "HIGH", "VOLATILE"]
          },
          "result": {
            "type": "string",
            "enum": ["WIN", "LOSS", "BREAKEVEN"]
          }
        }
      }
    },
    "total_trades": {
      "type": "integer",
      "minimum": 1
    },
    "generated_at": {
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{3}Z$"
    },
    "notes": {
      "type": "string"
    }
  }
}
